==================================
Plata 1.1 release notes (upcoming)
==================================


Backwards-incompatible changes
==============================

Order status addition
---------------------

The order status "confirmed" was confusingly named; what it really meant
all the time is that the order can be considered paid. Whether an order is
confirmed or not depends on the shop owner's definitions.

Because of this the existing ``Order.CONFIRMED`` status has been renamed
to ``Order.PAID``, ``Order.CONFIRMED`` has been added as a new order status
coming after ``Order.PAID``. Plata only knows about ``Order.PAID`` and never
changes an order to ``COMPLETED`` itself.

To update your installations to Plata v1.1, you'll have to make the following
changes:

* The method ``order.is_completed()`` has been removed. Either check for
  ``not order.balance_remaining`` (which only looks at the balance, not at the
  order status) or check for ``order.status >= order.PAID`` yourself. For
  consistency, the method ``order.is_confirmed()`` has been removed too.

* ``order.is_paid()`` has been deprecated and will be removed in the next
  release. Use ``order.status >= order.PAID`` or ``not order.balance_remaining``
  directly to clearly communicate your intentions instead.

* The shop signal ``order_completed`` has been renamed to ``order_paid``. Signal
  handlers receive the same arguments as before.

* The email template used in the ``SendInvoiceHandler`` has been renamed to
  ``order_paid.txt``.

* If you wrote your own payment modules, the method you'll want to call at the
  end is now named ``order_paid``, not ``order_completed`` anymore. Apart from
  the renaming the signature of the function has not changed.


Notable features
================

* Ogone is now a supported payment service provider (PSP).

* Users with a login are not asked whether they want to create a contact,
  this is done automatically. The checkout form is initialized with the
  values form the user model, too.

* If URLs named ``'order_packing_slip_pdf'`` and ``'order_invoice_pdf'``
  are reversible using only a keyword argument ``order_id`` (which only
  consists of a number, it is the primary key of the order model), a
  column with PDF links is automatically added to the orders list in the
  Django admin panel.

* The main :class:`~plata.shop.views.Shop` object gained an additional
  argument, ``base_template``, which can be used to specify a different
  base template than ``base.html`` which should be used in all
  checkout-related templates.

* Payment-related information is handled in its own method inside
  :class:`~plata.reporting.order.OrderReport` now, meaning that it is
  easier to override aspects of it in your shop.

* All rendering is done through a new method on the main shop view,
  :meth:`~plata.shop.views.Shop.render(self, request, context)`, making
  it straightforward to customize the rendering for all steps.


Bugfixes
========

* ``Order.status`` cannot be edited directly through the admin interface
  anymore. Add a new order status model if you need to manually change
  the order status.

* The PDF generation code actually checks whether an order is paid for now.
  Previously, it only checked whether a method named ``is_paid()`` existed
  on the order (which was always the case).
